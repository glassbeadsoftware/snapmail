name: build-webhapps

on:
  workflow_call:

jobs:
  build-webhapps:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      # install hc tool
      - name: Install hc tool and wasm target
        shell: bash # important because this runs shell scripts
        run: |
          npm run ci:hc-install
      # Download rsm repo
      - name: Download rsm
        shell: bash
        run: |
          npm run setup
      # Install hash-zome binary
      - name: Hash Zome Install
        run: |
          npm run install:hash-zome
      # Build happ
      - name: Build happ
        shell: bash
        run: |
          ./scripts/npm/dist-dna.sh
      # Hash zome
      - name: Hash zome
        shell: bash
        run: |
          npm run hash-zome
      # list uploads
      - name: list uploads
        continue-on-error: true
        run: ls
        working-directory: submodules
      # "upload" dna as build artifact
      - uses: actions/upload-artifact@master
        with:
          name: snapmail-dna-artifact
          path: submodules/snapmail.dna
      # "upload" happ as build artifact
      - uses: actions/upload-artifact@master
        with:
          name: snapmail-happ-artifact
          path: submodules/snapmail.happ
      # "upload" zome_hash as build artifact
      - uses: actions/upload-artifact@master
        with:
          name: model-hash-artifact
          path: electron/bin/model_zome_hash.txt
